<ui:composition template="/resources/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:b="http://bootsfaces.net/ui" xmlns:p="http://primefaces.org/ui"
	xmlns:hf="http://java.sun.com/jsf/composite/hf">
	<ui:define name="content">
		<ui:include src="/dialogs/NewParticipantDialog.xhtml" />

		<f:metadata>
			<f:viewParam name="id" value="#{competitionController.id}" />
			<f:event type="preRenderComponent"
				listener="#{competitionController.loadCompetition()}" />
		</f:metadata>
		<b:well size="sm" id="competitionTitle">
			<h4>
				<h:outputText value="#{competitionController.competition.subject}" />
			</h4>
			<h5>
				<h:outputText value="#{competitionController.competition.date}">
					<f:convertDateTime pattern="dd.MM.yyyy" type="date" />
				</h:outputText>
			</h5>
		</b:well>
		<h:form id="competitionForm">
			<b:tabView activeIndex="2">

				<b:tab title="Allgemein">
					<p:spacer height="5" />
					<hf:competitionMetadata
						competition="#{competitionController.competition}">
					</hf:competitionMetadata>


					<b:commandButton id="saveCompetition" value="Ok" look="primary"
						action="#{competitionController.saveCompetition()}"
						update="competitionTitle">
					</b:commandButton>

				</b:tab>
				<b:tab title="Wertungsklassen">
					<p:spacer height="5" />
					<b:row>
						<b:column span="10"></b:column>
						<b:column span="2">
							<p:remoteCommand name="initNewParticipant"
								actionListener="#{newParticipantDialogController.beforeOpen()}"
								update="newParticipantForm" />
						</b:column>

					</b:row>
					<b:row>
						<b:column span="12">
							<p:dataTable id="groups" var="group"
								value="#{competitionController.classificationGroups}"
								
								emptyMessage="Es wurden keine Wertungsklassen gefunden.">


								<p:columnGroup type="header">
									<p:row>
										<p:column  headerText="Klasse" />
										<p:column  headerText="Bezeichnung" />
										<p:column  headerText="von Jahrgang"  />
										<p:column  headerText="bis Jahrgang"  />
										<p:column  />										
									</p:row>
									
								</p:columnGroup>

								<p:subTable var="classification"
									value="#{group.classifications}">
									<f:facet name="header">
										<b:row>
											<b:column span="9">
												<h:outputText value="#{group.name}" />
											</b:column>

											<b:column span="3">
												<b:commandButton id="addClassification" styleClass="pull-right"
													value="Neue Wertungsklasse" iconAwesome="plus"
													onclick="initNewParticipant();$('.newParticipantPseudoClass').modal();return false;" />
											</b:column>
										</b:row>
									</f:facet>
									<p:column styleClass="col-md-3 col-xs-3" 
										priority="1">
										<h:outputText value="#{classification.shortName}" />
									</p:column>
									<p:column styleClass="col-md-3 col-xs-3"
										 priority="2">
										<h:outputText value="#{classification.longName}" />
									</p:column>
									<p:column styleClass="col-md-1 col-xs-1"
										 priority="1">
										<h:outputText value="#{classification.fromYearOfBirth}" />
									</p:column>
									<p:column styleClass="col-md-1 col-xs-1"
										priority="1">
										<h:outputText value="#{classification.toYearOfBirth}" />
									</p:column>
									<p:column styleClass="col-md-1 col-xs-1">
										<ul class="list-inline">
											<li></li>
										</ul>
									</p:column>
								</p:subTable>
							</p:dataTable>
						</b:column>
					</b:row>
				</b:tab>
				<b:tab title="Teilnehmer">
					<p:spacer height="5" />
					<b:row>
						<b:column span="10"></b:column>
						<b:column span="2">
							<p:remoteCommand name="initNewParticipant"
								actionListener="#{newParticipantDialogController.beforeOpen()}"
								update="newParticipantForm" />

							<b:commandButton id="addParticipant" value="Neuer Teilnehmer"
								iconAwesome="plus"
								onclick="initNewParticipant();$('.newParticipantPseudoClass').modal();return false;" />
						</b:column>
					</b:row>
					<b:row>
						<b:column span="12">
							<p:dataTable id="participants" var="participant"
								value="#{competitionController.competition.participants}"
								style="margin-top:5px"
								emptyMessage="Es wurden keine Teilnehmer gefunden.">
								<p:ajax event="sort" update="participants"
									process="participants" />

								<p:column styleClass="col-md-3 col-xs-3" 
									priority="2" sortBy="#{participant.athlete.firstName}">
									<h:outputText value="#{participant.athlete.firstName}" />
								</p:column>
								<p:column styleClass="col-md-3 col-xs-3" headerText="Nachname"
									priority="1" sortBy="#{participant.athlete.lastName}">
									<h:outputText value="#{participant.athlete.lastName}" />
								</p:column>
								<p:column styleClass="col-md-1 col-xs-1" headerText="Jahrgang"
									priority="1">
									<h:outputText value="#{participant.athlete.yearOfBirth}" />
								</p:column>
								<p:column styleClass="col-md-4 col-xs-4" headerText="Verein"
									priority="2">
									<h:outputText value="#{participant.athlete.club}" />
								</p:column>
								<p:column styleClass="col-md-1 col-xs-1">
									<ul class="list-inline">
										<li><hf:deleteLink
												actionListener="#{competitionController.removeParticipant(participant)}"
												update="competitionForm growl"></hf:deleteLink></li>
									</ul>
								</p:column>
							</p:dataTable>
						</b:column>
					</b:row>
				</b:tab>
				<b:tab title="Ergebnisse">
					<p:spacer height="5" />

				</b:tab>
			</b:tabView>
		</h:form>

	</ui:define>
</ui:composition>
